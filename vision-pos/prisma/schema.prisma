generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model communication_preferences {
  id                    String    @id
  customerId            String    @unique
  emailAppointments     Boolean   @default(true)
  emailPromotions       Boolean   @default(false)
  emailReminders        Boolean   @default(true)
  emailNewsletters      Boolean   @default(false)
  smsAppointments       Boolean   @default(true)
  smsPickupReady        Boolean   @default(true)
  smsPromotions         Boolean   @default(false)
  phoneAppointments     Boolean   @default(false)
  phoneFollowUp         Boolean   @default(false)
  phoneEmergencyContact Boolean   @default(true)
  mailingStatements     Boolean   @default(true)
  mailingPromotions     Boolean   @default(false)
  mailingCatalogs       Boolean   @default(false)
  createdAt             DateTime  @default(now())
  updatedAt             DateTime
  customers             customers @relation(fields: [customerId], references: [id])
}

model customer_addresses {
  id         String    @id
  customerId String
  type       String
  street     String
  street2    String?
  city       String
  state      String
  zipCode    String
  country    String    @default("USA")
  isPrimary  Boolean   @default(false)
  isActive   Boolean   @default(true)
  createdAt  DateTime  @default(now())
  updatedAt  DateTime
  customers  customers @relation(fields: [customerId], references: [id])
}

model customer_insurance {
  id                       String    @id
  customerId               String
  carrier                  String
  planName                 String?
  planType                 String
  memberId                 String
  groupNumber              String?
  effectiveDate            DateTime
  expirationDate           DateTime?
  copayAmount              Float?
  deductible               Float?
  isPrimary                Boolean   @default(false)
  isActive                 Boolean   @default(true)
  subscriberName           String?
  relationshipToSubscriber String?
  coverageDetails          Json
  createdAt                DateTime  @default(now())
  updatedAt                DateTime
  customers                customers @relation(fields: [customerId], references: [id])
}

model customer_preferences {
  id                        String    @id
  customerId                String    @unique
  preferredContactMethod    String    @default("EMAIL")
  appointmentReminders      Boolean   @default(true)
  promotionalEmails         Boolean   @default(false)
  language                  String    @default("en")
  timezone                  String    @default("America/New_York")
  preferredBrands           Json      @default("[]")
  budgetRange               Json?
  largeFont                 Boolean   @default(false)
  audioAssistance           Boolean   @default(false)
  wheelchairAccessible      Boolean   @default(false)
  preferredProviders        Json      @default("[]")
  preferredAppointmentTimes Json      @default("[]")
  specialInstructions       String?
  createdAt                 DateTime  @default(now())
  updatedAt                 DateTime
  customers                 customers @relation(fields: [customerId], references: [id])
}

model customer_purchase_history {
  id               String    @id
  customerId       String
  transactionId    String
  orderDate        DateTime
  totalAmount      Float
  paymentMethod    String
  prescriptionUsed String?
  providerId       String?
  itemsJson        String    @default("[]")
  createdAt        DateTime  @default(now())
  customers        customers @relation(fields: [customerId], references: [id])
}

model customer_relationships {
  id                                                            String    @id
  primaryCustomerId                                             String
  relatedCustomerId                                             String
  relationshipType                                              String
  isActive                                                      Boolean   @default(true)
  notes                                                         String?
  createdAt                                                     DateTime  @default(now())
  customers_customer_relationships_relatedCustomerIdTocustomers customers @relation("customer_relationships_relatedCustomerIdTocustomers", fields: [relatedCustomerId], references: [id])
  customers_customer_relationships_primaryCustomerIdTocustomers customers @relation("customer_relationships_primaryCustomerIdTocustomers", fields: [primaryCustomerId], references: [id])

  @@unique([primaryCustomerId, relatedCustomerId])
}

model customer_tag_assignments {
  id            String        @id
  customerId    String
  tagId         String
  createdAt     DateTime      @default(now())
  customer_tags customer_tags @relation(fields: [tagId], references: [id])
  customers     customers     @relation(fields: [customerId], references: [id])

  @@unique([customerId, tagId])
}

model customer_tags {
  id                       String                     @id
  name                     String                     @unique
  color                    String?
  category                 String?
  createdAt                DateTime                   @default(now())
  updatedAt                DateTime
  customer_tag_assignments customer_tag_assignments[]
}

model customer_visits {
  id                         String    @id
  customerId                 String
  visitDate                  DateTime
  visitType                  String
  providerId                 String?
  providerName               String?
  duration                   Int?
  notes                      String?
  outcome                    String?
  nextAppointmentRecommended Boolean   @default(false)
  createdAt                  DateTime  @default(now())
  customers                  customers @relation(fields: [customerId], references: [id])
}

model customers {
  id                                                                         String                      @id
  firstName                                                                  String
  lastName                                                                   String
  email                                                                      String?
  phone                                                                      String?
  dateOfBirth                                                                DateTime?
  gender                                                                     String?
  address                                                                    String?
  city                                                                       String?
  state                                                                      String?
  zipCode                                                                    String?
  insuranceCarrier                                                           String?
  memberId                                                                   String?
  groupNumber                                                                String?
  eligibilityDate                                                            DateTime?
  active                                                                     Boolean                     @default(true)
  customerNumber                                                             String?                     @unique
  accountStatus                                                              String                      @default("ACTIVE")
  registrationDate                                                           DateTime                    @default(now())
  lastVisit                                                                  DateTime?
  totalSpent                                                                 Float                       @default(0)
  averageOrderValue                                                          Float                       @default(0)
  customerLifetimeValue                                                      Float                       @default(0)
  lastPurchaseDate                                                           DateTime?
  isHighValueCustomer                                                        Boolean                     @default(false)
  isFrequentCustomer                                                         Boolean                     @default(false)
  riskLevel                                                                  String                      @default("LOW")
  marketingConsent                                                           Boolean                     @default(false)
  notes                                                                      String?
  createdAt                                                                  DateTime                    @default(now())
  updatedAt                                                                  DateTime
  createdBy                                                                  String?
  updatedBy                                                                  String?
  communication_preferences                                                  communication_preferences?
  customer_addresses                                                         customer_addresses[]
  customer_insurance                                                         customer_insurance[]
  customer_preferences                                                       customer_preferences?
  customer_purchase_history                                                  customer_purchase_history[]
  customer_relationships_customer_relationships_relatedCustomerIdTocustomers customer_relationships[]    @relation("customer_relationships_relatedCustomerIdTocustomers")
  customer_relationships_customer_relationships_primaryCustomerIdTocustomers customer_relationships[]    @relation("customer_relationships_primaryCustomerIdTocustomers")
  customer_tag_assignments                                                   customer_tag_assignments[]
  customer_visits                                                            customer_visits[]
  eye_prescriptions                                                          eye_prescriptions[]
  eyewear_preferences                                                        eyewear_preferences?
  quotes                                                                     quotes[]
  second_pairs                                                               second_pairs[]
  transactions                                                               transactions[]
  pofIncidents                                                               PofIncidents[]
}

model exam_services {
  id               String     @id
  name             String
  subtitle         String?
  price            Float
  duration         Int
  category         String
  insuranceCovered Boolean    @default(false)
  copay            Float?
  locationId       String?
  active           Boolean    @default(true)
  createdAt        DateTime   @default(now())
  updatedAt        DateTime
  createdBy        String?
  updatedBy        String?
  locations        locations? @relation(fields: [locationId], references: [id])
}

model eye_prescriptions {
  id                String    @id
  customerId        String
  prescriptionDate  DateTime
  providerId        String?
  providerName      String?
  rightEyeJson      String    @default("{}")
  leftEyeJson       String    @default("{}")
  pupillaryDistance Float?
  bifocalHeight     Float?
  prescriptionType  String
  notes             String?
  expirationDate    DateTime?
  isActive          Boolean   @default(true)
  createdAt         DateTime  @default(now())
  updatedAt         DateTime
  customers         customers @relation(fields: [customerId], references: [id])
}

model eyewear_preferences {
  id                 String    @id
  customerId         String    @unique
  frameStyles        Json      @default("[]")
  frameMaterials     Json      @default("[]")
  frameColors        Json      @default("[]")
  lensTypes          Json      @default("[]")
  lensCoatings       Json      @default("[]")
  contactLensBrands  Json      @default("[]")
  contactLensTypes   Json      @default("[]")
  framesBudget       Float?
  contactsBudget     Float?
  safetyRequirements Boolean   @default(false)
  computerGlasses    Boolean   @default(false)
  sportsEyewear      Boolean   @default(false)
  fashionPriority    String    @default("MEDIUM")
  comfortPriority    String    @default("HIGH")
  createdAt          DateTime  @default(now())
  updatedAt          DateTime
  customers          customers @relation(fields: [customerId], references: [id])
}

model insurance_carriers {
  id        String   @id
  name      String   @unique
  code      String   @unique
  active    Boolean  @default(true)
  config    Json?
  createdAt DateTime @default(now())
  updatedAt DateTime
}

model inventory {
  id                  String                @id
  productId           String
  locationId          String
  currentStock        Int                   @default(0)
  reservedStock       Int                   @default(0)
  availableStock      Int                   @default(0)
  reorderPoint        Int                   @default(5)
  reorderQuantity     Int                   @default(20)
  maxStock            Int?
  costPrice           Float?
  lastCostPrice       Float?
  lastRestocked       DateTime?
  lastSold            DateTime?
  createdAt           DateTime              @default(now())
  updatedAt           DateTime
  locations           locations             @relation(fields: [locationId], references: [id])
  products            products              @relation(fields: [productId], references: [id])
  inventory_movements inventory_movements[]

  @@unique([productId, locationId])
}

model inventory_movements {
  id            String    @id
  inventoryId   String
  type          String
  quantity      Int
  reason        String?
  referenceType String?
  referenceId   String?
  unitCost      Float?
  userId        String?
  notes         String?
  createdAt     DateTime  @default(now())
  users         users?    @relation(fields: [userId], references: [id])
  inventory     inventory @relation(fields: [inventoryId], references: [id])
}

model locations {
  id                String              @id
  name              String              @unique
  address           String
  phone             String?
  email             String?
  website           String?
  logo              String?             // File path for uploaded logo
  taxRate           Float?              // Location-specific tax rate
  timezone          String              @default("America/Los_Angeles")
  active            Boolean             @default(true)
  createdAt         DateTime            @default(now())
  updatedAt         DateTime
  exam_services     exam_services[]
  inventory         inventory[]
  product_locations product_locations[]
  purchase_orders   purchase_orders[]
  quotes            quotes[]
  second_pairs      second_pairs[]
  transactions      transactions[]
  users             users[]
  pofIncidents      PofIncidents[]
  activityLogs      user_activity_logs[]
}

model product_categories {
  id          String     @id
  name        String     @unique
  code        String     @unique
  description String?
  active      Boolean    @default(true)
  createdAt   DateTime   @default(now())
  updatedAt   DateTime
  products    products[]
}

model product_locations {
  id            String    @id
  productId     String
  locationId    String
  priceOverride Float?
  available     Boolean   @default(true)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime
  locations     locations @relation(fields: [locationId], references: [id])
  products      products  @relation(fields: [productId], references: [id])

  @@unique([productId, locationId])
}

model product_suppliers {
  id            String    @id
  productId     String
  supplierId    String
  supplierSku   String?
  supplierPrice Float?
  leadTimeDays  Int?
  minimumOrder  Int       @default(1)
  isPrimary     Boolean   @default(false)
  active        Boolean   @default(true)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime
  suppliers     suppliers @relation(fields: [supplierId], references: [id])
  products      products  @relation(fields: [productId], references: [id])

  @@unique([productId, supplierId])
}

model products {
  id                   String                 @id
  name                 String
  sku                  String?                @unique
  categoryId           String
  manufacturer         String?
  basePrice            Float
  tierVsp              String?
  tierEyemed           String?
  tierSpectera         String?
  active               Boolean                @default(true)
  createdAt            DateTime               @default(now())
  updatedAt            DateTime
  inventory            inventory[]
  product_locations    product_locations[]
  product_suppliers    product_suppliers[]
  product_categories   product_categories     @relation(fields: [categoryId], references: [id])
  purchase_order_items purchase_order_items[]
  transaction_items    transaction_items[]
}

model purchase_order_items {
  id               String          @id
  purchaseOrderId  String
  productId        String
  quantityOrdered  Int
  quantityReceived Int             @default(0)
  unitCost         Float
  total            Float
  notes            String?
  createdAt        DateTime        @default(now())
  updatedAt        DateTime
  products         products        @relation(fields: [productId], references: [id])
  purchase_orders  purchase_orders @relation(fields: [purchaseOrderId], references: [id])
}

model purchase_orders {
  id                   String                 @id
  supplierId           String
  locationId           String
  userId               String
  orderNumber          String                 @unique
  status               String                 @default("PENDING")
  subtotal             Float
  tax                  Float                  @default(0)
  shipping             Float                  @default(0)
  total                Float
  orderDate            DateTime               @default(now())
  expectedDate         DateTime?
  receivedDate         DateTime?
  notes                String?
  createdAt            DateTime               @default(now())
  updatedAt            DateTime
  purchase_order_items purchase_order_items[]
  users                users                  @relation(fields: [userId], references: [id])
  locations            locations              @relation(fields: [locationId], references: [id])
  suppliers            suppliers              @relation(fields: [supplierId], references: [id])
}

model quotes {
  id                                                  String         @id
  customerId                                          String
  userId                                              String
  locationId                                          String
  quoteNumber                                         String         @unique
  description                                         String?
  
  // Quote State Management - Week 7 Day 1
  status                                              String         @default("BUILDING") // BUILDING, DRAFT, PRESENTED, SIGNED, COMPLETED, CANCELLED, EXPIRED
  previousStatus                                      String?        // Track status history
  statusChangedAt                                     DateTime       @default(now())
  statusChangedBy                                     String?        // User ID who changed status
  statusReason                                        String?        // Reason for status change (especially for CANCELLED, EXPIRED)
  
  // Completion Flags
  buildingCompleted                                   Boolean        @default(false)  // All quote items added
  presentationCompleted                               Boolean        @default(false)  // Quote presented to customer
  signaturesCompleted                                 Boolean        @default(false)  // All required signatures collected
  paymentCompleted                                    Boolean        @default(false)  // Payment/insurance processed
  fulfillmentCompleted                                Boolean        @default(false)  // Products delivered/services completed
  
  // State Timestamps
  buildingCompletedAt                                 DateTime?      // When quote building was completed
  draftCreatedAt                                      DateTime?      // When saved as draft
  presentedAt                                         DateTime?      // When presented to customer
  signedAt                                            DateTime?      // When all signatures completed
  cancelledAt                                         DateTime?      // When cancelled
  expiredAt                                           DateTime?      // When expired
  
  // Auto-Expiration Fields
  autoExpireAfterDays                                 Int            @default(30)     // Days until auto-expire
  lastActivityAt                                      DateTime       @default(now())  // Track activity for expiration
  expireNotificationSent                              Boolean        @default(false)  // Whether expiration warning sent
  expireNotificationSentAt                            DateTime?      // When expiration warning sent
  
  patientInfo                                         Json
  insuranceInfo                                       Json
  examServices                                        Json
  eyeglasses                                          Json
  contacts                                            Json
  subtotal                                            Float
  tax                                                 Float          @default(0)
  discount                                            Float          @default(0)
  insuranceDiscount                                   Float          @default(0)
  total                                               Float
  patientResponsibility                               Float
  isSecondPair                                        Boolean        @default(false)
  secondPairOf                                        String?
  secondPairDiscount                                  Float          @default(0)
  secondPairType                                      String?
  
  // Patient-Owned Frame (POF) Fields
  isPatientOwnedFrame                                 Boolean        @default(false)
  pofInspectionCompleted                              Boolean        @default(false)
  pofConditionAssessment                              String?        // "EXCELLENT", "GOOD", "FAIR", "POOR"
  pofWaiverSigned                                     Boolean        @default(false)
  pofFrameDescription                                 String?        // Brand, model, color description
  pofFixedFee                                         Float          @default(0)
  pofInspectionNotes                                  String?
  pofInspectedBy                                      String?
  pofInspectedAt                                      DateTime?
  pofWaiverSignedAt                                   DateTime?
  
  examSignatureCompleted                              Boolean        @default(false)
  materialsSignatureCompleted                         Boolean        @default(false)
  examSignedAt                                        DateTime?
  materialsSignedAt                                   DateTime?
  expirationDate                                      DateTime
  completedAt                                         DateTime?
  createdAt                                           DateTime       @default(now())
  updatedAt                                           DateTime
  locations                                           locations      @relation(fields: [locationId], references: [id])
  users                                               users          @relation(fields: [userId], references: [id])
  customers                                           customers      @relation(fields: [customerId], references: [id])
  second_pairs_second_pairs_secondPairQuoteIdToquotes second_pairs?  @relation("second_pairs_secondPairQuoteIdToquotes")
  second_pairs_second_pairs_originalQuoteIdToquotes   second_pairs[] @relation("second_pairs_originalQuoteIdToquotes")
  pofIncidents                                        PofIncidents[]
  email_logs                                          email_logs[]
  signatures                                          signatures[]
}

model signatures {
  id                String    @id
  quoteId           String
  signatureType     String    // "EXAM", "MATERIALS"
  signatureData     String    // Base64 encoded signature image data
  signerName        String    // Name of the person signing
  signerRole        String?   // Role/title of signer (optional)
  ipAddress         String?   // IP address for audit trail
  userAgent         String?   // Browser/device info for audit trail
  deviceInfo        String?   // Additional device information
  timestamp         DateTime  @default(now())
  isValid           Boolean   @default(true)
  invalidatedAt     DateTime?
  invalidatedBy     String?   // User ID who invalidated
  invalidationReason String?  // Reason for invalidation
  
  // Signature verification data
  nameVerified      Boolean   @default(false)
  nameVerifiedAt    DateTime?
  nameVerifiedBy    String?   // User ID who verified name match
  
  // Metadata
  signatureWidth    Int?      // Canvas width for replay
  signatureHeight   Int?      // Canvas height for replay
  signatureHash     String?   // Hash of signature data for integrity
  
  // Audit trail
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  
  // Relations
  quotes            quotes    @relation(fields: [quoteId], references: [id])
  
  @@index([quoteId])
  @@index([signatureType])
  @@index([timestamp])
  @@index([signerName])
  @@map("signatures")
}

model second_pairs {
  id                                            String    @id
  originalQuoteId                               String
  secondPairQuoteId                             String    @unique
  customerId                                    String
  userId                                        String
  locationId                                    String
  discountType                                  String
  discountPercent                               Float
  discountAmount                                Float
  originalTotal                                 Float
  finalTotal                                    Float
  originalPurchaseDate                          DateTime
  secondPairPurchaseDate                        DateTime
  daysAfterOriginal                             Int
  managerOverride                               Boolean   @default(false)
  overrideReason                                String?
  overrideBy                                    String?
  createdAt                                     DateTime  @default(now())
  updatedAt                                     DateTime
  locations                                     locations @relation(fields: [locationId], references: [id])
  users                                         users     @relation(fields: [userId], references: [id])
  customers                                     customers @relation(fields: [customerId], references: [id])
  quotes_second_pairs_secondPairQuoteIdToquotes quotes    @relation("second_pairs_secondPairQuoteIdToquotes", fields: [secondPairQuoteId], references: [id])
  quotes_second_pairs_originalQuoteIdToquotes   quotes    @relation("second_pairs_originalQuoteIdToquotes", fields: [originalQuoteId], references: [id])
}

model suppliers {
  id                String              @id
  name              String              @unique
  contactName       String?
  email             String?
  phone             String?
  address           String?
  city              String?
  state             String?
  zipCode           String?
  country           String              @default("USA")
  website           String?
  taxId             String?
  paymentTerms      String?
  active            Boolean             @default(true)
  createdAt         DateTime            @default(now())
  updatedAt         DateTime
  product_suppliers product_suppliers[]
  purchase_orders   purchase_orders[]
}

model transaction_items {
  id                String       @id
  transactionId     String
  productId         String
  quantity          Int          @default(1)
  unitPrice         Float
  discount          Float        @default(0)
  total             Float
  insuranceTier     String?
  insuranceDiscount Float        @default(0)
  createdAt         DateTime     @default(now())
  updatedAt         DateTime
  products          products     @relation(fields: [productId], references: [id])
  transactions      transactions @relation(fields: [transactionId], references: [id])
}

model transactions {
  id                String              @id
  customerId        String
  userId            String
  locationId        String
  subtotal          Float
  tax               Float
  discount          Float               @default(0)
  total             Float
  insuranceCarrier  String?
  insuranceDiscount Float               @default(0)
  patientPortion    Float
  status            String              @default("PENDING")
  paymentMethod     String?
  createdAt         DateTime            @default(now())
  updatedAt         DateTime
  transaction_items transaction_items[]
  locations         locations           @relation(fields: [locationId], references: [id])
  users             users               @relation(fields: [userId], references: [id])
  customers         customers           @relation(fields: [customerId], references: [id])
}

model users {
  id                  String                @id
  email               String                @unique
  passwordHash        String?
  role                String                @default("SALES_ASSOCIATE")
  locationId          String
  firstName           String
  lastName            String
  active              Boolean               @default(true)
  createdAt           DateTime              @default(now())
  updatedAt           DateTime
  lastLoginAt         DateTime?
  passwordResetToken  String?
  passwordResetExpires DateTime?
  inventory_movements inventory_movements[]
  purchase_orders     purchase_orders[]
  quotes              quotes[]
  second_pairs        second_pairs[]
  transactions        transactions[]
  pofIncidents        PofIncidents[]
  activityLogs        user_activity_logs[]
  locations           locations             @relation(fields: [locationId], references: [id])
}

// Patient-Owned Frame (POF) Incident Tracking
model PofIncidents {
  id                  String              @id @default(cuid())
  quoteId             String
  customerId          String
  userId              String              // Staff member who reported
  locationId          String
  
  // Incident Details
  incidentType        String              // "FRAME_DAMAGE", "FITTING_ISSUE", "LENS_INCOMPATIBILITY", "LIABILITY_CLAIM", "OTHER"
  severity            String              // "LOW", "MEDIUM", "HIGH", "CRITICAL"
  title               String              // Brief incident title
  description         String              // Detailed incident description
  
  // Frame Information
  frameDescription    String?             // Description of the patient's frame
  frameCondition      String?             // Condition before/after incident
  
  // Resolution
  status              String              @default("OPEN") // "OPEN", "IN_PROGRESS", "RESOLVED", "ESCALATED"
  resolution          String?             // How the incident was resolved
  resolvedBy          String?             // Staff member who resolved
  resolvedAt          DateTime?
  
  // Financial Impact
  financialImpact     Float               @default(0)      // Cost of incident
  refundIssued        Float               @default(0)      // Any refund given
  
  // Documentation
  photosAttached      Boolean             @default(false)  // Whether photos were taken
  customerNotified    Boolean             @default(false)  // Customer awareness
  insuranceNotified   Boolean             @default(false)  // Insurance company notified
  
  // Audit Trail
  createdAt           DateTime            @default(now())
  updatedAt           DateTime            @updatedAt
  
  // Relations
  quotes              quotes              @relation(fields: [quoteId], references: [id])
  customers           customers           @relation(fields: [customerId], references: [id])
  users               users               @relation(fields: [userId], references: [id])
  locations           locations           @relation(fields: [locationId], references: [id])
  
  @@map("pof_incidents")
}

model email_logs {
  id                String    @id
  quoteId           String
  recipientEmail    String
  ccEmails          String?   // JSON array of CC emails
  bccEmails         String?   // JSON array of BCC emails
  subject           String
  status            String    // "SENT", "FAILED", "PENDING", "BOUNCED"
  provider          String?   // "sendgrid", "smtp", "ses"
  messageId         String?   // Provider message ID for tracking
  errorMessage      String?   // Error details if failed
  retryCount        Int       @default(0)
  sentAt            DateTime
  bounceReason      String?   // If email bounced
  openedAt          DateTime? // Email tracking (if supported)
  clickedAt         DateTime? // Link click tracking (if supported)
  
  // Relations
  quotes            quotes    @relation(fields: [quoteId], references: [id])
  
  @@index([quoteId])
  @@index([recipientEmail])
  @@index([status])
  @@map("email_logs")
}

model user_activity_logs {
  id          String    @id @default(cuid())
  userId      String
  action      String    // "QUOTE_CREATED", "QUOTE_UPDATED", "SALE_COMPLETED", "LOGIN", "LOGOUT", "PASSWORD_RESET", etc.
  entity      String?   // "QUOTE", "CUSTOMER", "PRODUCT", "USER", etc.
  entityId    String?   // ID of the entity being acted upon
  details     String?   // JSON string with additional details
  ipAddress   String?
  userAgent   String?
  locationId  String?
  metadata    String?   // Additional JSON metadata
  createdAt   DateTime  @default(now())
  
  user        users     @relation(fields: [userId], references: [id], onDelete: Cascade)
  location    locations? @relation(fields: [locationId], references: [id])
  
  @@index([userId])
  @@index([action])
  @@index([createdAt])
  @@index([locationId])
  @@map("user_activity_logs")
}
